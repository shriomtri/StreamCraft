<!DOCTYPE html>
<html>
<head>
  <title>Live Streaming Player</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <h1 class="text-center">Live Streaming Player</h1>
        <div class="card">
          <div class="card-body">
            <video id="videoPlayer" class="w-100" controls></video>
            <div class="mt-3">
              <label for="resolutionSelect" class="form-label">Select Resolution:</label>
              <select id="resolutionSelect" class="form-select">
                <option value="http://localhost:3000/stream/1080p/320x240/playlist.m3u8">1080p - 320x240</option>
                <option value="http://localhost:3000/stream/1080p/1280x720/playlist.m3u8">1080p - 1280x720</option>

                <option value="http://localhost:3000/stream/480p/320x240/playlist.m3u8">480p - 320x240</option>
                <option value="http://localhost:3000/stream/480p/1280x720/playlist.m3u8">480p - 1280x720</option>
                <!-- Add more options for different resolutions and dimensions -->
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    if (Hls.isSupported()) {
      const videoPlayer = document.getElementById('videoPlayer');
      const hls = new Hls();
      const resolutionSelect = document.getElementById('resolutionSelect');

      resolutionSelect.addEventListener('change', () => {
        const selectedPlaylistUrl = resolutionSelect.value;
        hls.destroy(); // Destroy the existing Hls instance

        // Create a new Hls instance and load the selected playlist
        const newHls = new Hls();
        newHls.loadSource(selectedPlaylistUrl);
        newHls.attachMedia(videoPlayer);

        newHls.on(Hls.Events.MANIFEST_PARSED, () => {
          // Video player is ready
          videoPlayer.play().catch(error => {
            console.error('Failed to start playback:', error);
          });
        });
      });

      hls.on(Hls.Events.MEDIA_ATTACHED, () => {
        // Wait for media to be attached before loading the initial playlist
        hls.loadSource(resolutionSelect.value);
        hls.attachMedia(videoPlayer);
      });

      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        // Video player is ready
        videoPlayer.play().catch(error => {
          console.error('Failed to start playback:', error);
        });
      });
    }
  </script>
</body>
</html>
